# Testing and Debugging Guide

Use this checklist to plan your manual testing before you run the app. Record what you expect to happen, exercise the scenario, and note the actual result so regressions are easy to spot.

- **Expected cases**: interactions you anticipate players/users will perform (e.g., toggling the lamp or saving a routine). Cover every normal path.
- **Boundary cases**: inputs at the edge of what should work (e.g., minimum brightness, routines that span midnight). Test both valid and invalid boundaries.
- **Invalid cases**: actions that should be rejected or safely handled (e.g., duplicate routines, missing permissions). Think about unusual but plausible misuse.

Enter each test in the table **before** running it. After executing the test, document the actual outcome, mark pass/fail, and capture any improvements you make.

| Case type (Expected, Boundary, Invalid): | Event / Input / Interaction:                                                                     | Expected outcome:                                                                                                                                        | Actual outcome:                       | Pass/Fail? | Improvements?                                                         |
| ---------------------------------------- | ------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------- | ---------- | --------------------------------------------------------------------- |
| Expected / Boundary / Invalid            | What action is being taken for this test                                                         | BEFORE TESTING: what do you think is going to happen                                                                                                     | AFTER TESTING: what actually happened |            | If improvements are made, briefly explain them, otherwise leave blank |
| Expected                                 | Circadian Light icon is tapped after a clean install                                             | App finishes one-time setup, shows the Home screen with 3D lamp and bottom nav visible, and no error snackbars appear.                                   |                                       |            |                                                                       |
| Expected                                 | App is opened while the ESP32 lamp is powered off                                                | Home screen loads with the red Disconnected indicator, controls stay interactive using last saved state, and no crash dialogs appear.                    |                                       |            |                                                                       |
| Expected                                 | Bottom nav: Routines tab is tapped from Home                                                     | Routines & Alarms screen slides in, the header reads "Routines & Alarms", and existing routine + alarm cards render.                                     |                                       |            |                                                                       |
| Expected                                 | Bottom nav: Settings tab is tapped from Home                                                     | Settings screen opens, showing Lamp Connection, Sun Sync, Dark Mode, and Help cards without layout glitches.                                             |                                       |            |                                                                       |
| Expected                                 | Home tab: app opens while an enabled routine is active                                           | Active routine banner appears, sliders are locked, lamp state matches the routine brightness/temperature, and a Disable Routine button is visible.       |                                       |            |                                                                       |
| Expected                                 | Home tab: power toggle pill is tapped while no routine is active                                 | Pill animation slides to the opposite side, lamp on/off state flips, ESP receives a `setOn` command, and the state persists after relaunch.            |                                       |            |                                                                       |
| Expected                                 | Home tab: brightness slider is dragged slightly to the left                                      | Slider thumb tracks the drag, subtitle updates to the new percentage (e.g., 65%), ESP sends a brightness command after debounce, and the value is saved. |                                       |            |                                                                       |
| Expected                                 | Home tab: temperature slider is dragged toward the warm side                                     | Thumb moves toward 2700K, subtitle switches to "Warm", ESP mode command fires after debounce, and the temperature persists across restart.               |                                       |            |                                                                       |
| Expected                                 | Home tab: Disable Routine button is tapped on the banner                                         | Snackbar confirms the routine was disabled, banner disappears, sliders unlock, and the routine's enabled flag flips to false in the database.            |                                       |            |                                                                       |
| Expected                                 | Home tab: Wi-Fi reconnects after a brief loss while screen is open                               | Connection LED flips from red to green within about a second, ESP state is requested, sliders jump to hardware state, and the sync timestamp updates.    |                                       |            |                                                                       |
| Expected                                 | Routines tab: Add Routine button is pressed and Save is tapped with valid times                  | Bottom sheet closes, new routine card appears enabled with chosen name/time/colour, entry is stored, and ESP sync runs when connected.                   |                                       |            |                                                                       |
| Expected                                 | Routines tab: Routine card toggle switch is flipped                                              | Card updates to Enabled/Disabled, state persists in SQLite, and ESP receives the updated routine payload when connected.                                 |                                       |            |                                                                       |
| Expected                                 | Routines tab: Routine card is opened, values edited, and Save Changes tapped                     | Card reflects new times/brightness/temperature, data persists, and ESP sync logs the update.                                                             |                                       |            |                                                                       |
| Expected                                 | Routines tab: Delete icon is tapped then Undo is pressed in snackbar                             | Routine disappears, Undo restores it with the same values, and list order matches previous.                                                              |                                       |            |                                                                       |
| Expected                                 | Routines tab: Add Alarm button is pressed and Create Alarm tapped                                | Alarm card is added with chosen wake time/duration, preview text matches the ramp, and data persists in the database.                                    |                                       |            |                                                                       |
| Expected                                 | Routines tab: Alarm card is opened, edits applied, and Save Changes tapped                       | Card shows updated wake time and duration, database row updates, and ESP sync message is sent if connected.                                              |                                       |            |                                                                       |
| Expected                                 | Routines tab: Info icon is tapped while the Sun Sync banner is present                           | Alert dialog pops up with the Sun Sync explanation, dismiss button closes it, and no other state changes.                                                |                                       |            |                                                                       |
| Expected                                 | Settings tab: Sun Sync switch is turned on when permission already granted                       | Switch stays on, sunrise manager enables, Routines screen shows the Sun Sync banner, location name populates, and snackbar announces success.            |                                       |            |                                                                       |
| Expected                                 | Settings tab: Sun Sync switch is turned off                                                      | Switch slides off, SunriseSunsetManager disables, manual routines become editable again, and banner disappears.                                          |                                       |            |                                                                       |
| Expected                                 | Settings tab: Refresh button is tapped after the ESP reconnects                                  | Connection status text updates to Connected, icon gradient turns green, and no duplicate snackbars appear.                                               |                                       |            |                                                                       |
| Expected                                 | Settings tab: Connect Device / Reconfigure WiFi button completes provisioning                    | Provisioning flow finishes successfully, returns to Settings, connection card reports Connected, and ESP sync runs if needed.                            |                                       |            |                                                                       |
| Expected                                 | Settings tab: Dark Mode switch is toggled                                                        | Theme flips instantly, background and navigation colours update, and the choice persists across relaunch.                                                |                                       |            |                                                                       |
| Expected                                 | Settings tab: Help Center card is tapped with internet available                                 | External browser opens the help URL, returning to the app keeps state intact.                                                                            |                                       |            |                                                                       |
| Expected                                 | Home tab: lamp state is saved after manual adjustments and app is relaunched                     | Relaunch restores brightness, temperature, and on/off state exactly as last set.                                                                         |                                       |            |                                                                       |
| Expected                                 | Home tab: 3D lamp card finishes loading after screen opens                                       | 3D viewer renders the lamp without placeholder errors, warm glow appears, and gestures remain responsive.                                                |                                       |            |                                                                       |
| Expected                                 | Home tab: ESP publishes a new lamp state while screen is visible                                 | Incoming state update snaps the sliders to the new values, saves to the database, and shows no duplicate snackbars.                                      |                                       |            |                                                                       |
| Expected                                 | Routines tab: opened with zero routines or alarms stored                                         | Centered text "No routines or alarms yet" appears, and Add Routine/Add Alarm calls-to-action stay visible.                                               |                                       |            |                                                                       |
| Expected                                 | Routines tab: Add Routine sheet is dismissed through the close icon                              | Sheet closes, no new routine card appears, and the list remains unchanged.                                                                               |                                       |            |                                                                       |
| Expected                                 | Routines tab: Add Routine sheet saved with the name left blank                                   | Routine saves with the autogenerated title (e.g., "Routine 1"), card shows that label, and settings persist.                                             |                                       |            |                                                                       |
| Expected                                 | Routines tab: active routine is edited to new brightness and saved                               | Returning to Home shows the banner with updated brightness/temperature, and ESP sync sends the revised payload.                                          |                                       |            |                                                                       |
| Expected                                 | Routines tab: toggle off the routine currently active on Home                                    | Banner disappears on Home without relaunch, sliders unlock, and routine card shows disabled styling.                                                     |                                       |            |                                                                       |
| Expected                                 | Routines tab: alarm toggle switch is flipped off                                                 | Alarm card dims, enabled flag becomes false in storage, and ESP sync disables the alarm when connected.                                                  |                                       |            |                                                                       |
| Expected                                 | Routines tab: alarm delete button is tapped then Undo is pressed                                 | Alarm card returns with original values, order is preserved, and enabled state matches before deletion.                                                  |                                       |            |                                                                       |
| Expected                                 | Settings tab: Sun Sync banner displays sunrise and sunset times after enabling                   | Sunrise and sunset times populate in the card, status text mentions location-based mode, and values persist when returning later.                        |                                       |            |                                                                       |
| Expected                                 | Routines tab: opened while Sun Sync is active                                                    | Sunrise/Sunset Sync status card fills the screen, manual routine and alarm cards show disabled styling, and Add buttons are hidden.                      |                                       |            |                                                                       |
| Expected                                 | Settings tab: reopen app after enabling Sun Sync keeps switch on                                 | Relaunch leaves the switch on, banner still visible in Routines, and manual routines remain locked.                                                      |                                       |            |                                                                       |
| Expected                                 | Settings tab: reopen app after completing provisioning keeps lamp connected                      | Connection card still shows Connected, Refresh confirms status, and no extra provisioning is required.                                                   |                                       |            |                                                                       |
| Boundary                                 | Home tab: brightness slider is dragged all the way left to 0% and then all the way right to 100% | At 0% the lamp remains minimally on (ESP value 1); at 100% it maps to 15; both extremes persist after reopening.                                         |                                       |            |                                                                       |
| Boundary                                 | Home tab: temperature slider is dragged to 2700K and then to 6500K                               | Subtitle flips to Warm and Cool, ESP modes switch to warm/white, and stored temperature reflects the extremes.                                           |                                       |            |                                                                       |
| Boundary                                 | Home tab: power toggle pill is tapped repeatedly with less than half a second between taps       | App debounces rapid toggles without crashing, ESP commands finish in order, and final lamp state matches the last tap.                                   |                                       |            |                                                                       |
| Boundary                                 | Routines tab: new routine saved where start time equals end time                                 | Routine saves as an all-day schedule, active routine detection keeps lamp aligned 24 hours.                                                              |                                       |            |                                                                       |
| Boundary                                 | Routines tab: new routine saved that spans 22:00 to 06:00                                        | Routine saves successfully, becomes active across midnight, and overlap detection respects wrap-around logic.                                            |                                       |            |                                                                       |
| Boundary                                 | Routines tab: enabling a routine that overlaps another enabled routine                           | Newly enabled routine stays active, overlapping routine auto-disables and card shows disabled styling.                                                   |                                       |            |                                                                       |
| Boundary                                 | Routines tab: alarm duration selector is set to 10 min and then 30 min                           | Preview start time updates for each duration, saved alarm stores both extremes correctly, and ramp calculation remains accurate.                         |                                       |            |                                                                       |
| Boundary                                 | Routines tab: alarm created with wake time 00:05 and 20 min ramp                                 | Start time wraps to previous day correctly, alarm saves, and preview messaging remains accurate.                                                         |                                       |            |                                                                       |
| Boundary                                 | Settings tab: Sun Sync enabled while the sunrise API times out                                   | Switch remains on, manager keeps last known/default times, and info banner mentions the fallback without crashing.                                       |                                       |            |                                                                       |
| Boundary                                 | Database: app launched on a brand-new install with no lamp state row                             | Default lamp state record is created, sliders initialize to defaults, and no null reference errors occur.                                                |                                       |            |                                                                       |
| Boundary                                 | Settings tab: Connect Device button is pressed while lamp already connected                      | Provisioning flow still completes, returns success, and connection status stays accurate afterwards.                                                     |                                       |            |                                                                       |
| Boundary                                 | Location service: sunrise/sunset request runs with only cached GPS coordinates                   | Manager reuses cached position, status message notes last update time, and automation keeps running.                                                     |                                       |            |                                                                       |
| Boundary                                 | Initialization: force database failure once to trigger retry screen                              | Error scaffold appears with retry button, and after fixing the issue tapping Retry restarts initialization and loads Home normally.                      |                                       |            |                                                                       |
| Boundary                                 | Home tab: ESP pushes a state update while brightness slider is mid-drag                          | Final state matches the ESP payload after debounce, slider snaps to the broadcast value, and no crashes occur.                                           |                                       |            |                                                                       |
| Boundary                                 | Sun Sync: adjust device clock to 10 minutes before sunrise window                                | Status text switches to "Sunrise in progress", lamp fades in using both LEDs, and transitions stay smooth.                                               |                                       |            |                                                                       |
| Boundary                                 | Sun Sync: adjust device clock to 10 minutes before sunset window                                 | Status text switches to "Sunset in progress", lamp switches to warm-only and eventually turns off, and no errant commands fire.                          |                                       |            |                                                                       |
| Boundary                                 | Settings tab: Sun Sync switch turned on while device location services are disabled              | Permission prompt appears, fallback uses last known/default times, and switch remains on without crashing.                                               |                                       |            |                                                                       |
| Boundary                                 | Settings tab: Dark Mode switch toggled on/off rapidly five times                                 | Theme flips each tap without layout glitches, and final selection persists after navigating away.                                                        |                                       |            |                                                                       |
| Boundary                                 | Routines tab: create more than ten routines to test list scrolling                               | List scrolls smoothly, bottom action buttons remain reachable, and no rendering artifacts appear.                                                        |                                       |            |                                                                       |
| Boundary                                 | Routines tab: enable an alarm that overlaps an enabled routine                                   | Newly enabled alarm stays active, overlapping routine auto-disables, and ESP sync reflects the updated active schedule.                                  |                                       |            |                                                                       |
| Boundary                                 | Settings tab: location name lookup returns no city                                               | Banner falls back to "Unknown Location" text, but Sun Sync stays active and times remain displayed.                                                      |                                       |            |                                                                       |
| Boundary                                 | Sun Sync: ESP hardware sends a sun_sync_state false message                                      | App turns the Sun Sync switch off automatically, banner vanishes, and manual controls unlock without user action.                                        |                                       |            |                                                                       |
| Invalid                                  | Settings tab: Sun Sync switch is turned on but location permission is denied                     | Permission dialog appears; if denied, switch snaps back off and snackbar directs the user to enable permissions.                                         |                                       |            |                                                                       |
| Invalid                                  | Settings tab: Sun Sync switch is turned on after permission was permanently denied               | Snackbar explains to open system Settings, switch stays off, and manager remains disabled.                                                               |                                       |            |                                                                       |
| Invalid                                  | Routines tab: Save is tapped with the same start/end/levels as an existing routine               | Snackbar warns the routine already exists, sheet stays open, and duplicate is not saved.                                                                 |                                       |            |                                                                       |
| Invalid                                  | Routines tab: Create Alarm is tapped with the same wake time and duration as an existing alarm   | Snackbar warns the alarm already exists, no extra card is added, and sheet stays open.                                                                   |                                       |            |                                                                       |
| Invalid                                  | Routines tab: while Sun Sync banner is active, a routine card is tapped                          | Card does not open the editor, tap is ignored, and disabled overlay stays in place.                                                                      |                                       |            |                                                                       |
| Invalid                                  | Routines tab: while Sun Sync banner is active, Add Routine button is pressed                     | Button is hidden/disabled so the sheet never opens; info banner explains to turn off Sun Sync.                                                           |                                       |            |                                                                       |
| Invalid                                  | Home tab: brightness or temperature slider is moved while routine banner is showing              | Sliders ignore the drag, values snap back, and banner instructs disabling the routine first.                                                             |                                       |            |                                                                       |
| Invalid                                  | Settings tab: Help Center card is tapped with no internet or launch failure                      | Snackbar reports the URL could not be opened and app continues normally.                                                                                 |                                       |            |                                                                       |
| Invalid                                  | Settings tab: Connect Device flow is started but user cancels before completion                  | Returning to Settings leaves connection state unchanged, no crash occurs, and snackbar may mention cancelled provisioning.                               |                                       |            |                                                                       |
| Invalid                                  | Home tab: ESP connection drops while brightness slider is being dragged                          | Indicator flips red, commands fail quietly, local state waits for reconnection, and no exception is thrown.                                              |                                       |            |                                                                       |
| Invalid                                  | Settings tab: Refresh button is tapped while ESP remains offline                                 | Status text stays Disconnected, no crash occurs, and user can retry later.                                                                               |                                       |            |                                                                       |
| Invalid                                  | Settings tab: Connect Device flow fails due to Wi-Fi provisioning error                          | Provisioning reports the failure, user returns to Settings with the card still showing Disconnected, and they can retry without a crash.                 |                                       |            |                                                                       |
| Invalid                                  | Initialization: underlying database issue persists after tapping Retry                           | Retry re-shows the failure screen with updated error text, Home never loads, and app remains in safe error state.                                        |                                       |            |                                                                       |
| Invalid                                  | Routines tab: with Sun Sync active, try toggling an alarm card                                   | Toggle stays visually disabled, no state change occurs, and snackbar/message explains that Sun Sync is locking manual items.                             |                                       |            |                                                                       |
| Invalid                                  | Routines tab: with Sun Sync active, attempt to press Add Alarm                                   | Add Alarm button is hidden/disabled so no sheet opens, and the Sun Sync banner explains the lock.                                                        |                                       |            |                                                                       |
